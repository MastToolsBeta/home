<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Gallery</title>
    <style>
        body {
            background-color: #1e1e1e; /* Dark background color */
            color: #fff; /* Light text color */
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
        }
        .image-container {
            margin: 10px;
            position: relative;
        }
        .image-container img {
            max-width: 200px;
            max-height: 200px;
            object-fit: cover;
        }
        .delete-button {
            display: none;
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 255, 255, 0.5);
            color: #000;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            padding: 5px;
        }
        .image-container:hover .delete-button,
        .image-container.clicked .delete-button {
            display: block;
        }
        .delete-button:hover {
            background-color: rgba(255, 0, 0, 0.7);
            color: #fff;
        }
        #fileInput {
            display: none;
        }
        #uploadButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #uploadButton:hover {
            background-color: #0056b3;
        }
        .hide-on-scroll-up {
            display: block;
            animation: hideScrollUp 0.5s forwards;
        }
        @keyframes hideScrollUp {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <input type="file" id="fileInput" accept="image/*" style="display: none;">
    <label for="fileInput" id="uploadButton">Choose an image</label>

    <div id="gallery"></div>

    <script>
        // Function to save uploaded image URL to localStorage
        function saveImageUrlToLocalStorage(imageUrl) {
            const images = JSON.parse(localStorage.getItem('images')) || [];
            images.push(imageUrl);
            localStorage.setItem('images', JSON.stringify(images));
        }

        // Function to load images from localStorage
        function loadImagesFromLocalStorage() {
            const images = JSON.parse(localStorage.getItem('images'));
            if (images) {
                const gallery = document.getElementById('gallery');
                images.forEach(imageUrl => {
                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('image-container');
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrl;
                    imageContainer.appendChild(imgElement);
                    
                    // Create delete button
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'X';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', function() {
                        if (confirm("Are you sure you want to delete this image?")) {
                            deleteImageUrlFromLocalStorage(imageUrl);
                            imageContainer.remove();
                        }
                    });
                    imageContainer.appendChild(deleteButton);

                    gallery.appendChild(imageContainer);
                });
            }
        }

        // Function to handle image upload
        async function uploadImage(file) {
            const formData = new FormData();
            formData.append('image', file);

            const apiKey = 'cb18ceb77734bc133ae0cb04ec665605'; // Your ImgBB API key

            try {
                const response = await fetch('https://api.imgbb.com/1/upload?key=' + apiKey, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                console.log(data); // Use data to display or process the uploaded image
                if (data.data && data.data.url) {
                    const imageUrl = data.data.url;
                    const gallery = document.getElementById('gallery');
                    const imageContainer = document.createElement('div');
                    imageContainer.classList.add('image-container');
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrl;
                    imageContainer.appendChild(imgElement);

                    // Create delete button
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'X';
                    deleteButton.classList.add('delete-button');
                    deleteButton.addEventListener('click', function() {
                        if (confirm("Are you sure you want to delete this image?")) {
                            deleteImageUrlFromLocalStorage(imageUrl);
                            imageContainer.remove();
                        }
                    });
                    imageContainer.appendChild(deleteButton);

                    // Prepend the new image container to the gallery
                    gallery.insertBefore(imageContainer, gallery.firstChild);

                    // Save uploaded image URL to localStorage
                    saveImageUrlToLocalStorage(imageUrl);
                } else {
                    console.error('Image upload failed');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
            }
        }

        // Function to delete image URL from localStorage
        function deleteImageUrlFromLocalStorage(imageUrl) {
            const images = JSON.parse(localStorage.getItem('images')) || [];
            const filteredImages = images.filter(img => img !== imageUrl);
            localStorage.setItem('images', JSON.stringify(filteredImages));
        }

        // Load images from localStorage when the page loads
        window.onload = loadImagesFromLocalStorage;

        // Automatically trigger image upload when a file is selected
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const files = event.target.files;
            if (files.length > 0) {
                uploadImage(files[0]);
            }
        });

        // Hide upload button on scroll up
        let lastScrollTop = 0;
        window.addEventListener("scroll", function() {
            let currentScroll = window.pageYOffset || document.documentElement.scrollTop;
            if (currentScroll > lastScrollTop) {
                document.getElementById("uploadButton").classList.add("hide-on-scroll-up");
            } else {
                document.getElementById("uploadButton").classList.remove("hide-on-scroll-up");
            }
            lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
        }, false);
    </script>
</body>
</html>
